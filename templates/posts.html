{% extends "layout.html" %}

{% block content %}

<h1 class="mb-4">Publicaciones</h1>

{% for post in contenidos %}
    <div class="card mb-4">
        <div class="card-body">
            {% if post.categoria %}
                <h5 class="text-muted">{{ post.categoria.nombre }}</h5>
            {% endif %}
            <h4 class="card-title">{{ post.titulo }}</h4>
            <p class="card-text">{{ post.contenido }}</p>
            <p class="card-text">
                <small class="text-muted">
                    Publicado por {{ post.autor.username }} el {{ post.fecha.strftime('%d/%m/%Y') }}
                </small>
            </p>

            <!-- Botón de ver comentarios solo si hay -->
            {% if post.comentarios|length > 0 %}
                <a href="{{ url_for('ver_comentarios', post_id=post.id) }}" class="btn btn-info btn-sm">Comentarios ({{ post.comentarios|length }})</a>
            {% endif %}

            {% if current_user.is_authenticated %}
                <a href="{{ url_for('comentar_post', post_id=post.id) }}" class="btn btn-primary btn-sm">Comentar</a>

                {% if post.autor.id == current_user.id %}
                    <a href="{{ url_for('editar_post', post_id=post.id) }}" class="btn btn-warning btn-sm">Editar</a>
                    <a href="{{ url_for('eliminar_post', post_id=post.id) }}" class="btn btn-danger btn-sm">Eliminar</a>
                {% endif %}
            {% endif %}
        </div>
    </div>
{% else %}
    <p>No hay publicaciones aún.</p>
{% endfor %}

{% if current_user.is_authenticated %}
    <div class="mt-4">
        <a href="{{ url_for('crear_posts') }}" class="btn btn-success">Crear Nueva Publicación</a>
    </div>
{% endif %}

{% endblock %}
